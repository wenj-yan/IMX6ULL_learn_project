## I2C

I2C 是最常用的通信接口，众多的传感器都会提供 I2C 接口来和主控相连，比如陀螺仪、加速度计、触摸屏等等。所以 I2C 是做嵌入式开发必须掌握的，I.MX6U 有 4 个 I2C 接口，可以通过这 4 个 I2C 接口来连接一些 I2C 外设。

I2C 是 NXP 公司设计的。

**I2C控制器**

I.MX6U 提供了 4 个 I2C 外设，通过这四个 I2C 外设即可完成与 I2C 从器件进行通信。

I.MX6U 的 I2C 支持两种模式：标准模式和快速模式，标准模式下 I2C 数据传输速率最高是 100Kbits/s，在快速模式下数据传输速率最高为 400Kbits/s。

**相关重要寄存器**

- I2Cx_IADR：地址寄存器（作为从机）
- I2Cx_IFDR：分频寄存器，用来设置 I2C 的波特率，I2C 的时钟源可以选 择 IPG_CLK_ROOT=66MHz，通过设置 IC 位既可以得到想要的 I2C 波特率。
- I2Cx_I2CR：控制寄存器
  - bit7:使能位
  - bit5:主从模式选择位
  - bit4:发送接受设置位
  - bit3:发送应答使能位
- I2Cx_I2DR：数据寄存器；要发送数据的时候将要发送的数据写入到此寄存器，如果要接收数据的话直接读取此寄存器即可得到接收到的数据。
- I2Cx_I2SR：状态寄存器

**AP3216C（环境传感器）**

支持环境光强度(ALS)、接近距离(PS)和红外线强度(IR)；通过 IIC 接口与主控制相连，并且支持中断。

AP3216C 常被用于手机、平板、导航设备等，其内置的接近传感器可以用于检测是否有物体接近，比如手机上用来检测耳朵是否接触听筒，如果检测到的话就表示正在打电话，手机就会关闭手机屏幕以省电。也可以使用环境光传感器检测光照强度，可以实现自动背光亮度调节。 

AP3216 的设备地址为 0X1E

**实验步骤**

1、初始化相应的 IO：初始化 I2C1 相应的 IO，设置其复用功能，如果要使用 AP3216C 中断功能的话，还需要设 置 AP3216C 的中断 IO。  

2、初始化 I2C1：初始化 I2C1 接口，设置波特率。  

3、初始化 AP3216C：初始化 AP3216C，读取 AP3216C 的数据。